.. _view_viewers:

동영상
******************

시청자수 집계
====================================

라이브 방송처럼 시청자수가 서비스의 핵심지표라면, 동시접속자를 시청자수와 같은 의미로 사용하는 것은 다소 문제의 소지가 있다.

.. note::

   만일 RTSP같은 스트리밍 프로토콜을 사용한다면 같은 의미로 볼 수 있다.
   하지만 HLS등 HTTP기반의 프로토콜이 폭넓은 호환성을 바탕으로 라이브 서비스에서도 널리 적용되고 있다.
   문제는 HTTP가 파일기반으로 설계되었고, 심지어 무상태(Stateless)로 동작하는 것에 기인한다.

1명의 시청자가 10초로 분할된 HLS 영상을 1분간 시청했다고 가정해 보자. 관점에 따라 시청자수는 전혀 다르게 계산될 수 있다.

-  **0.016** - 모든 TS파일을 다운로드 받는데 1초가 소요되어 **1초(트래픽 발생 시간) / 60초(시청시간)** 으로 계산한다.
-  **5** - 브라우저가 서버로 동시에 맺는 HTTP 세션 수는 5이다.
-  **6** - 다운로드된 TS파일의 개수는 6개이다.

이런 문제가 발생하는 근본적인 원인은 시청자수를 네트워크 관점만으로 계산했기 때문이다.
시청자수는 연결된 세션수나 다운로드 속도와 상관없이 전송된 동영상 재생시간의 총합으로 계산되어야 한다. ::

         전송된 동영상 재생시간의 합
   --------------------------------------
                단위 시간


예를 들어 축구경기 중계를 2시간 동안했다고 가정해보자. 
전송된 동영상 전체의 시간이 20만 시간이라면 평균 시청자수는 10만명이라고 볼 수 있다.
이는 매우 휴리스틱(Heuristic)한 접근이지만 꽤 효율적이다.

